package org.bjb;import java.awt.*;import java.awt.event.*;import javax.swing.*;import java.awt.geom.Point2D;import java.awt.geom.RoundRectangle2D;class BalanceViewer implements ActionListener {	int x=0,y=0;	Player p = null;	JPanel playingArea = null;	private static final Color flashColor = new Color(0x0033FF00);	private Color currentColor = Color.yellow;	private Color red2 = new Color(0xff0099);	private int flashCount = 0;	private javax.swing.Timer timer = null;	private RoundRectangle2D.Float back;	private boolean incorrect = false;		public BalanceViewer(Player p,int x,int y,JPanel playingArea) {		this.p = p;		this.x = x;		this.y = y;		this.playingArea = playingArea;	}		public void show(int balance) {		update(p.getBalance(),Color.yellow);	}		public void setCurrent(boolean current) {		incorrect = false;		if (current) flash();		else if (timer != null) {			timer.stop();			timer = null;			update(p.getBalance(),Color.yellow);		}	}		public void flashIncorrect() {		incorrect = true;		flashCount = 0;		flash(Color.red);		incorrect = true;		}		private void flash() {		flash(flashColor);	}		private void flash(Color c) {		currentColor = c;		update(p.getBalance(),currentColor);		if (timer != null) timer.stop();		timer = new javax.swing.Timer(100,this);		timer.start();	}				public void actionPerformed(ActionEvent evt) {		if (incorrect && currentColor.equals(Color.yellow))			currentColor = Color.red;		else if (currentColor.equals(Color.yellow)) 			currentColor = flashColor;		else currentColor = Color.yellow;		update(p.getBalance(),currentColor);		if (flashCount == 6) {			flashCount = 0;			timer.stop();			if (incorrect)				EffectsLocker.release();			update(p.getBalance(),flashColor);		}		else flashCount++;		}		public boolean contains(Point2D p) {		if (back != null)			return back.contains(p);		return false;	}		private void update(int balance,Color c) {		Graphics2D g2d = (Graphics2D)playingArea.getGraphics();		g2d.setColor(PlayingArea.lightGreen);		g2d.fillRect(this.x,this.y-31,75,34);		String s = null;		if (balance > 0)			s = new StringBuffer("+$").append(new Integer(balance).toString()).toString();		else 			s = new StringBuffer("-$").append(new Integer(Math.abs(balance)).toString()).toString();  		Font f = g2d.getFont();  		f = f.deriveFont(14f);  		g2d.setFont(f);  		FontMetrics fm = g2d.getFontMetrics(f);  		int line_height = fm.getHeight();  		int line_width = fm.stringWidth(s);  		int x = this.x + 8;  		int y = this.y - (line_height+10);        back = new RoundRectangle2D.Float( x-2, y-2, line_width+8, line_height+8, 15, 15);        g2d.setColor(Color.green);        g2d.fill(back);		RoundRectangle2D.Float roundedRectangle = new RoundRectangle2D.Float(x, y, line_width+4, line_height+4, 15, 15);        g2d.setColor(c);        g2d.fill(roundedRectangle);  		int maxCards = 0;  		for (int i=0;i<p.hands.length;i++) {  			if (p.hands[i] != null && p.hands[i].getNumCards() > maxCards) maxCards = p.hands[i].getNumCards();  			else if (p.hands[i] == null) break;  		}        if (c.equals(Color.yellow)) {        	GraphicsUtils.paint3DBorder(g2d,red2,PlayingArea.lightGreen,back);        	GraphicsUtils.hiliteHands(g2d,p,PlayingArea.lightGreen,PlayingArea.lightGreen);/*    		g2d.setStroke(new BasicStroke(4.0f));    		roundedRectangle = new RoundRectangle2D.Float(p.hands[0].x-5, p.hands[0].y-2, Hand.back.getIconWidth()+x-p.hands[0].x+5, Hand.back.getIconHeight()+(Hand.back.getIconHeight()/3*maxCards)+5, 15, 15);    		GraphicsUtils.paint3DBorder(g2d,PlayingArea.lightGreen,PlayingArea.lightGreen,roundedRectangle);*/        }        else if (c.equals(Color.red)) {        	GraphicsUtils.paint3DBorder(g2d,Color.blue,PlayingArea.lightGreen,back);        	GraphicsUtils.hiliteHands(g2d,p,Color.red,PlayingArea.lightGreen);        }        else {        	GraphicsUtils.paint3DBorder(g2d,BlackJackApp.teal,PlayingArea.lightGreen,back);        	GraphicsUtils.hiliteHands(g2d,p,BlackJackApp.teal,PlayingArea.lightGreen); /*    		g2d.setStroke(new BasicStroke(4.0f));    		roundedRectangle = new RoundRectangle2D.Float(p.hands[0].x-5, p.hands[0].y-2, Hand.back.getIconWidth()+x-p.hands[0].x+5, Hand.back.getIconHeight()+(Hand.back.getIconHeight()/3*maxCards)+5, 15, 15);    		GraphicsUtils.paint3DBorder(g2d,BlackJackApp.teal,PlayingArea.lightGreen,roundedRectangle);*/        }        if (balance > 0) g2d.setColor(Color.black);        else g2d.setColor(Color.red);   		g2d.drawString(s,x,y+line_height);  	}		public void showWongedOut() {		Graphics2D g2d = (Graphics2D)playingArea.getGraphics(); 		g2d.setStroke(new BasicStroke(4.0f));  		RoundRectangle2D.Float roundedRectangle = new RoundRectangle2D.Float(p.hands[0].x-5, p.hands[0].y-2, Hand.back.getIconWidth()+10, Hand.back.getIconHeight()+(Hand.back.getIconHeight()/3*5)+5, 15, 15);		GraphicsUtils.paint3DBorder(g2d,Color.lightGray,Color.darkGray,roundedRectangle);	  			}}